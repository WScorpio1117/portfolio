name: Auto Deploy & Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ” Run functionality checks
        run: |
          echo "ğŸ§ª é–‹å§‹åŠŸèƒ½æª¢æŸ¥..."
          node scripts/test.js
          echo "âœ… åŠŸèƒ½æª¢æŸ¥å®Œæˆï¼"

      - name: ğŸ“Š Generate report
        run: |
          echo "åŠŸèƒ½æª¢æŸ¥å ±å‘Š" > test-report.txt
          echo "æ™‚é–“: $(date)" >> test-report.txt
          echo "âœ… æ‰€æœ‰æ¸¬è©¦é€šé" >> test-report.txt

      - name: ğŸ“¤ Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: test-report
          path: test-report.txt

  notify:
    needs: deploy
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: ğŸ“¢ Deployment Status
        run: |
          if [ "${{ needs.deploy.result }}" == "success" ]; then
            echo "âœ… éƒ¨ç½²æˆåŠŸï¼"
            echo "æ‚¨çš„ç¶²ç«™å·²æ›´æ–°ã€‚"
          else
            echo "âŒ éƒ¨ç½²å¤±æ•—"
            echo "è«‹æª¢æŸ¥éŒ¯èª¤æ—¥èªŒã€‚"
          fi